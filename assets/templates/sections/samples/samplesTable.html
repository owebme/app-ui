<section-samples-table>

    <table id="datatable-buttons" class="dataTable">
        <thead>
            <th></th>
            <th></th>
            <th>Должность</th>
            <th></th>
        </thead>
        <tbody>
        </tbody>
    </table>

<script>

    var $ = this,
    $scope = $$($.root);

    $.init = function(data){
        $.table = $scope.find(".dataTable").DataTable(
            $Samples.config($, data, function(){
                // Initialize dataTable
            })
        );
        $.table.elem = $$($.table.context[0].nTable);

        // Reset search result
        $.table.elem.on("click", ".dataTables__reset", function(){
            $.search.resetAll();
        });

        // Checked item
        $.table.elem.on("click", ".dataTable__checkbox", function(){
            var $row = $$(this).closest("tr"),
                item = $.table.row($row[0]).data(),
                id = item._id;

            $row.toggleClass("selected");
            $store.samples.select({'_id': id}).set("_checked", !item.checked);
        });

        $.table.elem.on("click", "tbody > tr", function(e){
            var item = e.target,
                cl = item.getAttribute("class");

            if (cl && !cl.match(/checkbox/)){
                var id = $.get.id(this);
                if (id){
                    $Sections.sample.show(id);
                }
            }
        });

        //$.table.elem.find(".dataTable__button__edit:first").trigger("click");
    };

    $.refresh = {
        item: function(id){
            var row = $.table.row('#' + id);
            if (row && row[0] && row[0].length){
                row.data($store.samples.get({"_id": id})).draw("page");
            }
        },
        all: function(){
            $.table.clear().draw();
            $.table.rows.add($store.samples.get()).draw();
        }
    };

    $.search = {
        column: function(num, value){
            $.table.column(num).search(value, false, true, true).draw();
        },
        reset: function(){
            $.table.columns().search('').draw();
        },
        resetAll: function(){
            $.table.search('').columns().search('').draw();
        }
    };

    $.get = {
        row: function(cursor){
            return $.table.row($$(cursor).closest("tr")[0]);
        },
        item: function(cursor){
            return this.row(cursor).data();
        },
        id: function(cursor){
            var item = this.item(cursor);
            return item && item._id;
        },
        date: function(date){
            return moment(date).format('D/MM');
        }
    };

    $.on("unmount", function(){
        $.table.elem.off();
        $.table.destroy();
    });


</script>

</section-samples-table>
